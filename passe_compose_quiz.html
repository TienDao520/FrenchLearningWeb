<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Passé Composé Quiz - TCF Preparation</title>
    <link rel="stylesheet" href="./css/subpages.css">
</head>
<body>
    <div class="container">
        <button id="back-button"><a href="index.html">Back to Main Page</a></button>
        <div id="question"></div>
        <div id="options"></div>
        <button id="next" style="display: none;">Next Question</button>
        <div id="feedback"></div>
    </div>

    <script>
        const subjects = [
            {fr: "je", en: "I", aux_avoir: "ai", aux_etre: "suis"},
            {fr: "tu", en: "you (informal)", aux_avoir: "as", aux_etre: "es"},
            {fr: "il", en: "he", aux_avoir: "a", aux_etre: "est"},
            {fr: "elle", en: "she", aux_avoir: "a", aux_etre: "est"},
            {fr: "nous", en: "we", aux_avoir: "avons", aux_etre: "sommes"},
            {fr: "vous", en: "you (formal/plural)", aux_avoir: "avez", aux_etre: "êtes"},
            {fr: "ils", en: "they (masc)", aux_avoir: "ont", aux_etre: "sont"},
            {fr: "elles", en: "they (fem)", aux_avoir: "ont", aux_etre: "sont"}
        ];

        const verbs = [
            {inf: "manger", part: "mangé", en: "ate", aux_type: "avoir", complements: [
                {fr: "une pomme.", en: "an apple."},
                {fr: "un sandwich.", en: "a sandwich."},
                {fr: "la pizza.", en: "the pizza."},
                {fr: "un gâteau.", en: "a cake."}
            ]},
            {inf: "regarder", part: "regardé", en: "watched", aux_type: "avoir", complements: [
                {fr: "la télévision.", en: "television."},
                {fr: "un film.", en: "a movie."},
                {fr: "un match de foot.", en: "a soccer match."}
            ]},
            {inf: "acheter", part: "acheté", en: "bought", aux_type: "avoir", complements: [
                {fr: "une voiture.", en: "a car."},
                {fr: "des livres.", en: "books."},
                {fr: "des vêtements.", en: "clothes."}
            ]},
            {inf: "donner", part: "donné", en: "gave", aux_type: "avoir", complements: [
                {fr: "un cadeau.", en: "a gift."},
                {fr: "de l'argent.", en: "money."},
                {fr: "des conseils.", en: "advice."}
            ]},
            {inf: "faire", part: "fait", en: "did/made", aux_type: "avoir", complements: [
                {fr: "les devoirs.", en: "homework."},
                {fr: "une promenade.", en: "a walk."},
                {fr: "du sport.", en: "sports."}
            ]},
            {inf: "voir", part: "vu", en: "saw", aux_type: "avoir", complements: [
                {fr: "un ami.", en: "a friend."},
                {fr: "le film.", en: "the movie."},
                {fr: "un médecin.", en: "a doctor."}
            ]},
            {inf: "choisir", part: "choisi", en: "chose", aux_type: "avoir", complements: [
                {fr: "un cadeau.", en: "a gift."},
                {fr: "la robe.", en: "the dress."},
                {fr: "un plat.", en: "a dish."}
            ]},
            {inf: "vendre", part: "vendu", en: "sold", aux_type: "avoir", complements: [
                {fr: "sa voiture.", en: "his car."},
                {fr: "la maison.", en: "the house."},
                {fr: "des billets.", en: "tickets."}
            ]},
            {inf: "inviter", part: "invité", en: "invited", aux_type: "avoir", complements: [
                {fr: "des amis à dîner.", en: "friends to dinner."},
                {fr: "sa famille.", en: "his family."},
                {fr: "à une fête.", en: "to a party."}
            ]},
            {inf: "finir", part: "fini", en: "finished", aux_type: "avoir", complements: [
                {fr: "ses devoirs.", en: "his homework."},
                {fr: "le projet.", en: "the project."},
                {fr: "le repas.", en: "the meal."}
            ]},
            {inf: "oublier", part: "oublié", en: "forgot", aux_type: "avoir", complements: [
                {fr: "son parapluie.", en: "his umbrella."},
                {fr: "l'anniversaire.", en: "the birthday."},
                {fr: "ses clés.", en: "his keys."}
            ]},
            {inf: "gagner", part: "gagné", en: "won", aux_type: "avoir", complements: [
                {fr: "le match.", en: "the match."},
                {fr: "la loterie.", en: "the lottery."},
                {fr: "un prix.", en: "a prize."}
            ]},
            {inf: "ranger", part: "rangé", en: "tidied", aux_type: "avoir", complements: [
                {fr: "sa chambre.", en: "his room."},
                {fr: "les livres.", en: "the books."},
                {fr: "la cuisine.", en: "the kitchen."}
            ]},
            {inf: "décider", part: "décidé", en: "decided", aux_type: "avoir", complements: [
                {fr: "de ranger son bureau chaque semaine.", en: "to tidy his office every week."},
                {fr: "de partir en vacances.", en: "to go on vacation."},
                {fr: "d'étudier le français.", en: "to study French."}
            ]},
            {inf: "écouter", part: "écouté", en: "listened to", aux_type: "avoir", complements: [
                {fr: "la musique.", en: "music."},
                {fr: "un podcast.", en: "a podcast."},
                {fr: "la radio.", en: "the radio."},
                {fr: "les conseils du professeur.", en: "the teacher's advice."}
            ]},
            {inf: "parler", part: "parlé", en: "spoke", aux_type: "avoir", complements: [
                {fr: "au professeur.", en: "to the teacher."},
                {fr: "avec ses amis.", en: "with his friends."},
                {fr: "en français.", en: "in French."},
                {fr: "de ses projets.", en: "about his projects."}
            ]},
            {inf: "attendre", part: "attendu", en: "waited for", aux_type: "avoir", complements: [
                {fr: "le bus.", en: "the bus."},
                {fr: "ses amis.", en: "his friends."},
                {fr: "le train.", en: "the train."}
            ]},
            {inf: "travailler", part: "travaillé", en: "worked", aux_type: "avoir", complements: [
                {fr: "au bureau.", en: "at the office."},
                {fr: "sur un projet.", en: "on a project."},
                {fr: "toute la journée.", en: "all day."}
            ]},
            {inf: "lire", part: "lu", en: "read", aux_type: "avoir", complements: [
                {fr: "un livre.", en: "a book."},
                {fr: "le journal.", en: "the newspaper."},
                {fr: "un roman.", en: "a novel."}
            ]},
            {inf: "écrire", part: "écrit", en: "wrote", aux_type: "avoir", complements: [
                {fr: "une lettre.", en: "a letter."},
                {fr: "un courriel.", en: "an email."},
                {fr: "un rapport.", en: "a report."}
            ]},
            {inf: "boire", part: "bu", en: "drank", aux_type: "avoir", complements: [
                {fr: "du café.", en: "coffee."},
                {fr: "un verre d'eau.", en: "a glass of water."},
                {fr: "du thé.", en: "tea."}
            ]},
            {inf: "prendre", part: "pris", en: "took", aux_type: "avoir", complements: [
                {fr: "le bus.", en: "the bus."},
                {fr: "une décision.", en: "a decision."},
                {fr: "des photos.", en: "photos."}
            ]},
            {inf: "recevoir", part: "reçu", en: "received", aux_type: "avoir", complements: [
                {fr: "une lettre.", en: "a letter."},
                {fr: "un cadeau.", en: "a gift."},
                {fr: "un appel.", en: "a call."}
            ]},
            {inf: "conduire", part: "conduit", en: "drove", aux_type: "avoir", complements: [
                {fr: "la voiture.", en: "the car."},
                {fr: "jusqu'à Paris.", en: "to Paris."}
            ]},
            {inf: "courir", part: "couru", en: "ran", aux_type: "avoir", complements: [
                {fr: "un marathon.", en: "a marathon."},
                {fr: "dans le parc.", en: "in the park."}
            ]},
            {inf: "savoir", part: "su", en: "knew", aux_type: "avoir", complements: [
                {fr: "la réponse.", en: "the answer."},
                {fr: "nager.", en: "to swim."}
            ]},
            {inf: "pouvoir", part: "pu", en: "was able to", aux_type: "avoir", complements: [
                {fr: "venir hier.", en: "come yesterday."},
                {fr: "finir à temps.", en: "finish on time."}
            ]},
            {inf: "aller", part: "allé", en: "went", aux_type: "etre", complements: [
                {fr: "au parc.", en: "to the park."},
                {fr: "en vacances.", en: "on vacation."},
                {fr: "à l'université.", en: "to the university."},
                {fr: "au cinéma.", en: "to the cinema."}
            ]},
            {inf: "venir", part: "venu", en: "came", aux_type: "etre", complements: [
                {fr: "de Paris.", en: "from Paris."},
                {fr: "chez moi.", en: "to my house."},
                {fr: "à la fête.", en: "to the party."}
            ]},
            {inf: "arriver", part: "arrivé", en: "arrived", aux_type: "etre", complements: [
                {fr: "à l'heure.", en: "on time."},
                {fr: "en avance.", en: "early."},
                {fr: "à l'aéroport.", en: "at the airport."}
            ]},
            {inf: "partir", part: "parti", en: "left", aux_type: "etre", complements: [
                {fr: "en voyage.", en: "on a trip."},
                {fr: "tôt.", en: "early."},
                {fr: "pour l'école.", en: "for school."}
            ]},
            {inf: "sortir", part: "sorti", en: "went out", aux_type: "etre", complements: [
                {fr: "avec des amis.", en: "with friends."},
                {fr: "du bâtiment.", en: "from the building."},
                {fr: "du restaurant.", en: "from the restaurant."}
            ]},
            {inf: "monter", part: "monté", en: "went up", aux_type: "etre", complements: [
                {fr: "les escaliers.", en: "the stairs."},
                {fr: "à l'étage.", en: "upstairs."},
                {fr: "dans la voiture.", en: "into the car."}
            ]},
            {inf: "descendre", part: "descendu", en: "went down", aux_type: "etre", complements: [
                {fr: "les escaliers.", en: "the stairs."},
                {fr: "de la montagne.", en: "from the mountain."},
                {fr: "du train.", en: "from the train."}
            ]},
            {inf: "entrer", part: "entré", en: "entered", aux_type: "etre", complements: [
                {fr: "dans la maison.", en: "into the house."},
                {fr: "dans la salle.", en: "into the room."},
                {fr: "à l'université.", en: "university."}
            ]},
            {inf: "retourner", part: "retourné", en: "returned", aux_type: "etre", complements: [
                {fr: "à l'école.", en: "to school."},
                {fr: "chez lui.", en: "home."},
                {fr: "en France.", en: "to France."}
            ]},
            {inf: "tomber", part: "tombé", en: "fell", aux_type: "etre", complements: [
                {fr: "par terre.", en: "on the ground."},
                {fr: "dans l'eau.", en: "into the water."},
                {fr: "malade.", en: "ill."}
            ]},
            {inf: "rester", part: "resté", en: "stayed", aux_type: "etre", complements: [
                {fr: "à la maison.", en: "at home."},
                {fr: "en ville.", en: "in town."},
                {fr: "à l'hôtel.", en: "at the hotel."}
            ]},
            {inf: "naître", part: "né", en: "was born", aux_type: "etre", complements: [
                {fr: "en 1995.", en: "in 1995."},
                {fr: "à Paris.", en: "in Paris."},
                {fr: "au Canada.", en: "in Canada."}
            ]},
            {inf: "mourir", part: "mort", en: "died", aux_type: "etre", complements: [
                {fr: "en 2020.", en: "in 2020."},
                {fr: "jeune.", en: "young."},
                {fr: "à l'hôpital.", en: "in the hospital."}
            ]},
            {inf: "devenir", part: "devenu", en: "became", aux_type: "etre", complements: [
                {fr: "médecin.", en: "a doctor."},
                {fr: "célèbre.", en: "famous."},
                {fr: "professeur.", en: "a teacher."}
            ]},
            {inf: "rentrer", part: "rentré", en: "returned home", aux_type: "etre", complements: [
                {fr: "tard.", en: "late."},
                {fr: "à la maison.", en: "home."},
                {fr: "de l'école.", en: "from school."}
            ]},
            {inf: "passer", part: "passé", en: "passed by", aux_type: "etre", complements: [
                {fr: "par le marché.", en: "by the market."},
                {fr: "devant la boulangerie.", en: "in front of the bakery."},
                {fr: "un examen.", en: "an exam."}
            ]},
            {inf: "revenir", part: "revenu", en: "came back", aux_type: "etre", complements: [
                {fr: "à la maison.", en: "home."},
                {fr: "de vacances.", en: "from vacation."},
                {fr: "plus tard.", en: "later."}
            ]},
            {inf: "demeurer", part: "demeuré", en: "remained", aux_type: "etre", complements: [
                {fr: "en France.", en: "in France."},
                {fr: "au pouvoir.", en: "in power."}
            ]},
            {inf: "se laver", part: "lavé", en: "washed oneself", aux_type: "etre", complements: [
                {fr: "les mains.", en: "one's hands."},
                {fr: "le visage.", en: "one's face."}
            ]},
            {inf: "se lever", part: "levé", en: "got up", aux_type: "etre", complements: [
                {fr: "tôt.", en: "early."},
                {fr: "du lit.", en: "from bed."}
            ]},
            {inf: "se coucher", part: "couché", en: "went to bed", aux_type: "etre", complements: [
                {fr: "tard.", en: "late."},
                {fr: "à minuit.", en: "at midnight."}
            ]},
            {inf: "s'habiller", part: "habillé", en: "got dressed", aux_type: "etre", complements: [
                {fr: "en rouge.", en: "in red."},
                {fr: "rapidement.", en: "quickly."}
            ]},
            {inf: "se promener", part: "promené", en: "went for a walk", aux_type: "etre", complements: [
                {fr: "dans le parc.", en: "in the park."},
                {fr: "avec le chien.", en: "with the dog."}
            ]}
        ];

        let correctAnswer = '';
        let correctEnglish = '';
        let answeredCorrectly = false;

        function buildSentence(sub, aux_str, part, comp_fr) {
            let pron = sub.fr;
            if (pron === "je" && /^[aeiouh]/i.test(aux_str)) {
                pron = "j'";
            }
            let sentence = pron.charAt(0).toUpperCase() + pron.slice(1) + " " + aux_str + " " + part + " " + comp_fr;
            return sentence;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function speakFrench(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'fr-FR';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            } else {
                const audioUrl = `https://translate.google.com/translate_tts?ie=UTF-8&tl=fr&client=tw-ob&q=${encodeURIComponent(text)}`;
                const audio = new Audio(audioUrl);
                audio.volume = 0.5;
                audio.play().catch(error => {
                    console.error('Audio playback failed:', error);
                    document.getElementById('feedback').innerHTML = 'Correct! (Audio playback failed)<br>Translation: "' + correctEnglish + '"';
                    document.getElementById('feedback').style.display = 'block';
                    document.getElementById('feedback').style.color = '#155724';
                });
            }
        }

        function generateQuestion() {
            const sub = subjects[Math.floor(Math.random() * subjects.length)];
            const v = verbs[Math.floor(Math.random() * verbs.length)];
            const comp = v.complements[Math.floor(Math.random() * v.complements.length)];

            const aux_str = v.aux_type === "avoir" ? sub.aux_avoir : sub.aux_etre;
            let part = v.part;
            if (v.aux_type === "etre") {
                if (["elle", "elles"].includes(sub.fr)) part += "e";
                if (["nous", "vous", "ils", "elles"].includes(sub.fr)) part += "s";
            }
            const correctFrench = buildSentence(sub, aux_str, part, comp.fr);
            correctEnglish = sub.en + " " + v.en + " " + comp.en;
            correctAnswer = correctFrench;

            const wrong_aux_type = v.aux_type === "avoir" ? "etre" : "avoir";
            const wrong_aux_str = wrong_aux_type === "avoir" ? sub.aux_avoir : sub.aux_etre;
            let wrong_part1 = v.part;
            if (wrong_aux_type === "etre") {
                if (["elle", "elles"].includes(sub.fr)) wrong_part1 += "e";
                if (["nous", "vous", "ils", "elles"].includes(sub.fr)) wrong_part1 += "s";
            }
            const wrong1 = buildSentence(sub, wrong_aux_str, wrong_part1, comp.fr);

            const all_aux = subjects.map(s => v.aux_type === "avoir" ? s.aux_avoir : s.aux_etre);
            let filtered_aux = all_aux.filter(a => a !== aux_str);
            const other_aux = filtered_aux[Math.floor(Math.random() * filtered_aux.length)];
            const wrong2 = buildSentence(sub, other_aux, part, comp.fr);

            const wrong3 = buildSentence(sub, aux_str, v.inf, comp.fr);

            let options = [correctFrench, wrong1, wrong2, wrong3];
            shuffle(options);

            document.getElementById('question').innerHTML = `For the verb "${v.inf}", which clause is correct in passé composé? (TCF-style practice)`;

            const optsDiv = document.getElementById('options');
            optsDiv.innerHTML = '';
            const letters = ['a.', 'b.', 'c.', 'd.'];
            options.forEach((opt, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';

                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'choice';
                radio.value = opt;
                radio.id = 'opt-' + index;

                const label = document.createElement('label');
                label.htmlFor = radio.id;
                label.innerText = letters[index] + ' ' + opt;

                optionDiv.appendChild(radio);
                optionDiv.appendChild(label);
                optsDiv.appendChild(optionDiv);

                radio.addEventListener('change', () => {
                    if (answeredCorrectly) {
                        if (radio.value === correctAnswer) {
                            speakFrench(correctAnswer);
                        }
                        return;
                    }
                    checkAnswer(radio);
                });
            });

            document.getElementById('feedback').innerHTML = '';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('next').style.display = 'none';
            answeredCorrectly = false;
        }

        function checkAnswer(selectedRadio) {
            const selectedValue = selectedRadio.value;
            const allRadios = document.querySelectorAll('input[name="choice"]');
            const allLabels = document.querySelectorAll('.option label');

            allLabels.forEach(label => {
                label.classList.remove('correct', 'wrong');
            });

            if (selectedValue === correctAnswer) {
                selectedRadio.nextElementSibling.classList.add('correct');
                speakFrench(correctAnswer);
                answeredCorrectly = true;
                document.getElementById('next').style.display = 'block';
                document.getElementById('feedback').innerHTML = 'Correct!<br>Translation: "' + correctEnglish + '"';
                document.getElementById('feedback').style.display = 'block';
                document.getElementById('feedback').style.color = '#155724';
            } else {
                selectedRadio.nextElementSibling.classList.add('wrong');
                document.getElementById('feedback').innerHTML = 'Wrong! Try another option.';
                document.getElementById('feedback').style.display = 'block';
                document.getElementById('feedback').style.color = '#721c24';
            }
        }

        document.getElementById('next').addEventListener('click', generateQuestion);

        generateQuestion();
    </script>
</body>
</html>